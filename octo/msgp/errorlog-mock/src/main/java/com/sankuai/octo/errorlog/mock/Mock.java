package com.sankuai.octo.errorlog.mock;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

/**
 * Created by yves on 16/12/15.
 * 执行ErrorLog Mock 服务
 */

@Service
public class Mock {
    private Logger logger = LoggerFactory.getLogger(Mock.class);
    private ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
    private SimpleDateFormat DATE_TIME_FORMAT = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

    @PostConstruct
    public void startMockService() {
        scheduler.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                String current = DATE_TIME_FORMAT.format(new Date(System.currentTimeMillis() / 1000L / 60L * 60L * 1000L));
                String logMessage = "Error log auto-generated by mock service. time: " + current;
                logger.info(logMessage);
                logger.error(logMessage);
                System.out.println(logMessage);
            }
        }, 0, 60L, TimeUnit.SECONDS);
    }

    public void printMessage(String str) {
        System.out.println("From mock: " + str);
    }
}
