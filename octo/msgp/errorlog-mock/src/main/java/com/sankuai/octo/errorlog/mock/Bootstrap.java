package com.sankuai.octo.errorlog.mock;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.text.SimpleDateFormat;
import java.util.Date;
import java.util.concurrent.Executors;
import java.util.concurrent.ScheduledExecutorService;
import java.util.concurrent.TimeUnit;

@Service
public class Bootstrap {
    Logger logger = LoggerFactory.getLogger(Bootstrap.class);
    ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor();
    SimpleDateFormat DATE_TIME_FORMAT = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss");

    @PostConstruct
    public void init() {
        startMockService();
    }


    private void startMockService() {
        scheduler.scheduleAtFixedRate(new Runnable() {
            @Override
            public void run() {
                String current = DATE_TIME_FORMAT.format(new Date(System.currentTimeMillis() / 1000l / 60l * 60l * 1000l));
                logger.info("Error log auto-generated by mock service. time: " + current);
                logger.error("Error log auto-generated by mock service. time:  " + current);
            }
        }, 0, 60l, TimeUnit.SECONDS);
    }
}
